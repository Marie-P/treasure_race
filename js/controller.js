import Model from"./model.js";import Character from"./utils/character.js";import View from"./view.js";export default class Controller{constructor(){this.model=new Model,this.view=new View(this.model.nbPlayers),this.charactersNames=["luffy","pikachu","naruto","Valider","Retour au menu principal"],this.charactersUrls=["./assets/menu/luffy_choix.png","./assets/menu/pikachu_choix.png","./assets/menu/naruto_choix.png"],this.selectionMenu=[this.validate,this.backToMainMenu],this.btnTwoPlayers=null,this.btnsCharacter1=[],this.btnsCharacter2=[]}mainMenu(){this.model.activeJoystick=!1;let t=document.createElement("div"),e=document.createElement("p");t.className="mainMenu",e.innerHTML="<center>Bienvenue sur Treasure Race !</center><br>Choisissez une option : ",e.style.fontSize="60px",document.body.appendChild(e);let i=["1 Joueur","2 Joueurs","Règles du Jeu"],s=["","",""],o=[this.onePlayer,this.twoPlayers,this.rulesDescription];for(let e=0;e<3;e++)if(1==e)this.btnTwoPlayers=this.addButton(i[e],s[e],o[e]),t.appendChild(this.btnTwoPlayers);else{let n=this.addButton(i[e],s[e],o[e]);t.appendChild(n)}document.body.appendChild(t)}addButton(t,e,i){let s=document.createElement("button"),o=document.createTextNode(t);if(e){let t=new Image;t.src=e,s.appendChild(t)}else s.appendChild(o);return i==this.getCharacter1||i==this.getCharacter2?s.addEventListener("click",i.bind(this,o,s)):s.addEventListener("click",i.bind(this)),s}clean(){for(;document.body.childNodes.length;)document.body.removeChild(document.body.firstChild)}backToMainMenu(){this.clean(),this.stop(),document.body.style.height="90vh",document.body.style.overflow="auto",document.body.style.position="relative",this.mainMenu()}getCharacter1(t,e){this.model.choosenFirstCharacter=t.nodeValue,this.btnsCharacter1.forEach(t=>{t.style.background="transparent"}),e.style.background="blue"}getCharacter2(t,e){this.model.choosenSecondCharacter=t.nodeValue,this.btnsCharacter2.forEach(t=>{t.style.background="transparent"}),e.style.background="green"}addCharactersButtons(t,e,i){1==i?this.btnsCharacter1=[]:this.btnsCharacter2=[];let s=document.createElement("div");s.appendChild(t);for(let t=0;t<3;t++){let o=this.addButton(this.charactersNames[t],this.charactersUrls[t],e);1==i?this.btnsCharacter1.push(o):this.btnsCharacter2.push(o),s.appendChild(o)}document.body.appendChild(s)}addSelectionButtons(){let t=document.createElement("div");for(let e=0;e<2;e++){let i=this.addButton(this.charactersNames[e+3],"",this.selectionMenu[e]);i.style.width=document.body.clientWidth<=500?document.body.clientWidth-30*document.body.clientWidth/100+"px":"400px",t.appendChild(i)}document.body.appendChild(t)}onePlayer(){this.clean(),this.model.nbPlayers=1;let t=document.createElement("p");t.innerHTML="Joueur 1 : ",this.addCharactersButtons(t,this.getCharacter1,1),this.addSelectionButtons()}twoPlayers(){if(document.body.clientWidth>500){this.clean(),this.model.nbPlayers=2;let t=document.createElement("p"),e=document.createElement("p");t.innerHTML="Joueur 1 : ",e.innerHTML="Joueur 2 : ",this.addCharactersButtons(t,this.getCharacter1,1),this.addCharactersButtons(e,this.getCharacter2,2),this.addSelectionButtons()}else this.btnTwoPlayers.style.background="red"}rulesDescription(){this.clean();let t=document.createElement("p");t.innerHTML="<center>Règles du jeu :</center> <br>Le but du jeu est de récupérer le trésor qui se trouve à la fin de votre parcours.    <br>Vous pouvez jouer seul sur ordinateur et utiliser les touches directionnelles de votre clavier.    <br><br>Vous pouvez également jouer sur votre téléphone ou votre tablette. Dans ce cas, vous pouvez utiliser les touches directionnelles, ainsi que le joystick, se trouvant sur votre écran.    <br><br>Lorsque vous jouez à 2 (ATTENTION : seulement possibles sur ordinateur), l’objectif est toujours de récupérer le trésor, mais cette fois avant votre adversaire.    <br><br>Le premier joueur doit utiliser les flèches directionnelles du clavier, le deuxième les touches z (pour sauter) et d (pour avancer).    <br><br>Excepté pour le joystick, vous pouvez appuyer sans relâcher les différentes touches pour courir, sinon pour marcher, n'appuyez que de manière discontinu.";let e=this.addButton("Retour au menu principal","",this.backToMainMenu);e.style.width=document.body.clientWidth<=500?document.body.clientWidth-30*document.body.clientWidth/100+"px":"400px",e.style.display="block",document.body.appendChild(t),document.body.appendChild(e)}validate(){this.clean(),this.view.camera1=0,this.load()}async load(){this.view.setView(this.model.nbPlayers),await this.initMap(),await this.initCharacters(),document.body.appendChild(this.view.canvas),2==this.model.nbPlayers&&document.body.appendChild(this.view.canvas2),document.body.style.height="100%",document.body.style.overflow="hidden",document.body.style.position="fixed",this.model.activeJoystick=!0,this.start()}async initMap(){await this.model.setMap(),this.proceduralGeneration()}async initCharacters(){let t=await fetch("./assets/atlas/"+this.model.choosenFirstCharacter+".json"),e=await t.json(),i=await this.model.pic("./assets/atlas/"+e.meta.image);this.setCharacter(e,i,1),2==this.model.nbPlayers&&(t=await fetch("./assets/atlas/"+this.model.choosenSecondCharacter+".json"),e=await t.json(),i=await this.model.pic("./assets/atlas/"+e.meta.image),this.setCharacter(e,i,2))}proceduralGeneration(){this.initSprite(this.view.context),this.setBackground(Math.floor(3*Math.random()),this.view.backgroundWidth,this.view.backgroundHeight,this.model.map.tilemap,1),this.setCourse(this.view.canvas,this.model.map.tilemap),2==this.model.nbPlayers&&(this.initSprite(this.view.context2),this.setBackground(Math.floor(3*Math.random()),this.view.backgroundWidth2,this.view.backgroundHeight2,this.model.map.tilemap2,2),this.setCourse(this.view.canvas2,this.model.map.tilemap2))}initSprite(t){t.drawImage(this.model.map.tileset,0,0,this.model.map.tileset.width,this.model.map.tileset.height);for(let e=0;e<this.model.map.tileset.height/this.model.map.tilesHeight;e++)for(let i=0;i<this.model.map.tileset.width/this.model.map.tilesWidth;i++)this.model.map.sprites.push(t.getImageData(i*this.model.map.tilesWidth,e*this.model.map.tilesHeight,this.model.map.tilesWidth,this.model.map.tilesHeight))}setBackground(t,e,i,s,o){let n=0==t?[30,29,70,69]:1==t?[110,109,150,149]:2==t?[190,189,230,229]:[];for(let t=0;t+1<i;t+=2)for(let i=0;i+1<this.model.map.sizeWidth;i+=2)s[t*e+i]=n[0],s[t*e+(i+1)]=n[1],s[(t+1)*e+i]=n[2],s[(t+1)*e+(i+1)]=n[3];1==o?(this.model.map.savedBackground1=s[13*e+380],s[13*e+380]=82):(this.model.map.savedBackground2=s[13*e+380],s[13*e+380]=82)}setCourse(t,e){let i=this.model.map.spritesSupport[Math.floor(Math.random()*this.model.map.spritesSupport.length)];for(let s=0;s<this.model.map.sizeWidth;s++){let o=s+5;if(1==Math.floor(2*Math.random())||s<5||s>375)for(s-=1;s<o;s++)e[14*t.width+s]=i;else for(s-=1;s<o;s++)e[9*t.width+s]=i}}setCharacter(t,e,i){1==i?(this.model.character1=new Character(t,e,this.model.choosenFirstCharacter,0,this.lastSprites(this.model.choosenFirstCharacter)),this.setSprites(this.model.character1,this.model.choosenFirstCharacter)):2==i&&(this.model.character2=new Character(t,e,this.model.choosenSecondCharacter,0,this.lastSprites(this.model.choosenSecondCharacter)),this.setSprites(this.model.character2,this.model.choosenSecondCharacter))}setSprites(t){t.posX=0,t.posY=12,this.addSprites(t,t.name,"walk",t.lastSprites.walk),this.addSprites(t,t.name,"stand",t.lastSprites.stand),this.addSprites(t,t.name,"run",t.lastSprites.run),this.addSprites(t,t.name,"fall",t.lastSprites.fall),this.addSprites(t,t.name,"jump",t.lastSprites.jump),this.addSprites(t,t.name,"win",t.lastSprites.win),this.addSprites(t,t.name,"lose",t.lastSprites.lose)}addSprites(t,e,i,s){t.addSprites(i,s,e+"_"+i,this.setPosX(t.name,i),this.setPosY(t.name,i))}lastSprites(t){return"pikachu"==t?{walk:5,stand:1,fall:1,run:5,jump:7,win:24,lose:1}:"naruto"==t?{walk:6,stand:1,fall:1,run:10,jump:7,win:49,lose:1}:"luffy"==t?{walk:5,stand:1,fall:1,run:8,jump:6,win:18,lose:1}:void 0}setPosX(t,e){return"pikachu"==t?"walk"==e?[.1,.1,.1,.6,.1]:"run"==e?.2:1:"naruto"==t?"walk"==e?[.6,.1,.1,.2,.1,.1]:"run"==e?.2:1:"luffy"==t?"walk"==e?[.1,1,.1,.1,1]:"run"==e?.2:1:void 0}setPosY(t,e){return"pikachu"==t?"walk"==e?[0,-.1,0,-.2,0]:"run"==e?.3:"jump"==e?[-.7,-3,-6.5,-6.5,-6.5,-6,-5]:"win"==e?-.4:0:"naruto"==t?"walk"==e?-1.8:"run"==e?-1:"jump"==e?[-.7,-.7,-6.5,-6.5,-6.5,-6,-5]:"win"==e?[-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-1,-1,-1,-1,-1,-1,-1,-1,-1]:-1.6:"luffy"==t?"walk"==e?-2:"run"==e?-1.3:"jump"==e?[-1.8,-1.8,-7,-7,-7,-10]:-1.8:void 0}moveWithKeys(){this.model.keysArray.forEach(t=>{switch(t){case"ArrowRight":this.arrowRightMovement(this.model.character1),this.model.countBeforeRunning1++;break;case"ArrowUp":this.model._direction="N",this.arrowUpMovement(this.model.character1);break;case"KeyD":this.arrowRightMovement(this.model.character2),this.model.countBeforeRunning2++;break;case"KeyW":this.model._direction2="N",this.arrowUpMovement(this.model.character2);break;default:this.model._direction=null,this.model._direction2=null}})}keydownFunction(t){-1===this.model.keysArray.indexOf(t.code)&&this.model.keysArray.push(t.code),this.moveWithKeys()}keyupFunction(t){switch(this.model.keysArray.splice(this.model.keysArray.indexOf(t.code),this.model.keysArray.indexOf(t.code)+1),"ArrowUp"==t.code||"ArrowLeft"==t.code||"ArrowDown"==t.code||"ArrowRight"==t.code?this._isMoving=!1:"KeyW"!=t.code&&"KeyA"!=t.code&&"KeyS"!=t.code&&"KeyD"!=t.code||(this._isMoving2=!1),t.code){case"ArrowRight":this.model.countBeforeRunning1=0,"fall"!=this.model.character1.move&&"jump"!=this.model.character1.move&&"win"!=this.model.character1.move&&"lose"!=this.model.character1.move&&"walk"!=this.model.character1.move&&this.model.character1.stand();break;case"KeyD":this.model.countBeforeRunning2=0,"fall"!=this.model.character2.move&&"jump"!=this.model.character2.move&&"win"!=this.model.character2.move&&"lose"!=this.model.character2.move&&"walk"!=this.model.character2.move&&this.model.character2.stand()}}touchstartFunction(t){this.model.activeJoystick&&(t.touches[0].clientX>=this.model.backButtonX&&t.touches[0].clientX<=this.model.backButtonWx+this.model.backButtonX&&t.touches[0].clientY>=this.model.backButtonY&&t.touches[0].clientY<=this.model.backButtonWy+this.model.backButtonY&&this.backToMainMenu(),1==this.model.nbPlayers&&(t.touches[0].clientX<=this.view.joystick.centerX+50&&t.touches[0].clientX>=this.view.joystick.centerX-50&&t.touches[0].clientY<=this.view.joystick.centerY+50&&t.touches[0].clientY>=this.view.joystick.centerY-50&&(this.view.joystick.x=t.touches[0].clientX,this.view._y=t.touches[0].clientY,this.model._isMoving=!0),t.touches[0].clientX<this.view.directionalButtonsX+this.view.directionalButtonsH&&t.touches[0].clientX>this.view.directionalButtonsX-(this.view.buttons._wx-5)&&t.touches[0].clientY<this.view.directionalButtonsY-(this.view.buttons._wy-5)-this.view.directionalButtonsH&&t.touches[0].clientY>this.view.directionalButtonsY-2*this.view.buttons._wy?(this.model._direction="N",this.model._isMoving=!0,this.view.buttons._hUp=0,this.view.buttons._xUp=this.view.directionalButtonsX,this.view.buttons._yUp=this.view.directionalButtonsY-this.view.directionalButtonsH):t.touches[0].clientY<this.view.directionalButtonsY+this.view.directionalButtonsH&&t.touches[0].clientY>this.view.directionalButtonsY-(this.view.buttons._wy-5)&&t.touches[0].clientX<this.view.directionalButtonsX+(this.view.buttons._wx+5)+this.view.directionalButtonsH&&t.touches[0].clientX>this.view.directionalButtonsX+this.view.directionalButtonsH?(this.arrowRightMovement(this.model.character1),this.model.pressed=!0,this.view.buttons._hRight=0,this.view.buttons._xRight=this.view.directionalButtonsX+this.view.directionalButtonsH,this.view.buttons._yRight=this.view.directionalButtonsY):t.touches[0].clientX<this.view.directionalButtonsX+this.view.directionalButtonsH&&t.touches[0].clientX>this.view.directionalButtonsX-(this.view.buttons._wx-5)&&t.touches[0].clientY<this.view.directionalButtonsY+(this.view.buttons._wy+5)+this.view.directionalButtonsH&&t.touches[0].clientY>this.view.directionalButtonsY+this.view.directionalButtonsH?(this.view.buttons._hDown=0,this.view.buttons._xDown=this.view.directionalButtonsX,this.view.buttons._yDown=this.view.directionalButtonsY+this.view.directionalButtonsH):t.touches[0].clientY<this.view.directionalButtonsY+this.view.directionalButtonsH&&t.touches[0].clientY>this.view.directionalButtonsY-(this.view.buttons._wy-5)&&t.touches[0].clientX<this.view.directionalButtonsX-(this.view.buttons._wx-5)-this.view.directionalButtonsH&&t.touches[0].clientX>this.view.directionalButtonsX-2*this.view.buttons._wx&&(this.view.buttons._hLeft=0,this.view.buttons._xLeft=this.view.directionalButtonsX-this.view.directionalButtonsH,this.view.buttons._yLeft=this.view.directionalButtonsY)))}touchmoveFunction(t){this.model.activeJoystick&&1==this.model.nbPlayers&&this.model._isMoving&&(t.touches[0].clientX<=this.view.joystick.centerX+50&&t.touches[0].clientX>=this.view.joystick.centerX-50&&(this.view.joystick.x=t.touches[0].clientX),t.touches[0].clientY<=this.view.joystick.centerY+50&&t.touches[0].clientY>=this.view.joystick.centerY-50&&(this.view.joystick.y=t.touches[0].clientY),"win"!=this.model.character1.move&&"lose"!=this.model.character1.move&&(t.touches[0].clientY<=this.view.joystick.centerY-45?this.arrowUpMovement(this.model.character1):t.touches[0].clientX>=this.view.joystick.centerX+45?(this.model.countBeforeRunning1=4,this.model._direction="E",this.model.character1.run(),this.arrowRightMovement(this.model.character1)):t.touches[0].clientX>=this.view.joystick.centerX+10&&(this.model.countBeforeRunning1=0,this.arrowRightMovement(this.model.character1))))}touchendFunction(t){this.model.activeJoystick&&1==this.model.nbPlayers&&("run"==this.model.character1.move&&this.model.character1.stand(),this.model.countBeforeRunning1=0,this.view.joystick.x=this.view.joystick.centerX,this.view.joystick.y=this.view.joystick.centerY,this.model._isMoving=!1,this.model.pressed=!1,this.view.buttons._hUp=this.view.directionalButtonsH,this.view.buttons._xUp=this.view.directionalButtonsX,this.view.buttons._yUp=this.view.directionalButtonsY,this.view.buttons._hRight=this.view.directionalButtonsH,this.view.buttons._xRight=this.view.directionalButtonsX,this.view.buttons._yRight=this.view.directionalButtonsY,this.view.buttons._hDown=this.view.directionalButtonsH,this.view.buttons._xDown=this.view.directionalButtonsX,this.view.buttons._yDown=this.view.directionalButtonsY,this.view.buttons._hLeft=this.view.directionalButtonsH,this.view.buttons._xLeft=this.view.directionalButtonsX,this.view.buttons._yLeft=this.view.directionalButtonsY)}mousedownFunction(t){this.model.activeJoystick&&1==this.model.nbPlayers&&(t.clientX<=this.view.joystick.centerX+50&&t.clientX>=this.view.joystick.centerX-50&&t.clientY<=this.view.joystick.centerY+50&&t.clientY>=this.view.joystick.centerY-50&&(this.view.joystick.x=t.clientX,this.view.joystick.y=t.clientY,this.model._isMoving=!0),t.clientX<this.view.directionalButtonsX+this.view.directionalButtonsH&&t.clientX>this.view.directionalButtonsX-(this.view.buttons._wx-5)&&t.clientY<this.view.directionalButtonsY-(this.view.buttons._wy-5)-this.view.directionalButtonsH&&t.clientY>this.view.directionalButtonsY-2*this.view.buttons._wy?(this.model._direction="N",this.model._isMoving=!0,this.view.buttons._hUp=0,this.view.buttons._xUp=this.view.directionalButtonsX,this.view.buttons._yUp=this.view.directionalButtonsY-this.view.directionalButtonsH):t.clientY<this.view.directionalButtonsY+this.view.directionalButtonsH&&t.clientY>this.view.directionalButtonsY-(this.view.buttons._wy-5)&&t.clientX<this.view.directionalButtonsX+(this.view.buttons._wx+5)+this.view.directionalButtonsH&&t.clientX>this.view.directionalButtonsX+this.view.directionalButtonsH?(this.arrowRightMovement(this.model.character1),this.model.pressed=!0,this.view.buttons._hRight=0,this.view.buttons._xRight=this.view.directionalButtonsX+this.view.directionalButtonsH,this.view.buttons._yRight=this.view.directionalButtonsY):t.clientX<this.view.directionalButtonsX+this.view.directionalButtonsH&&t.clientX>this.view.directionalButtonsX-(this.view.buttons._wx-5)&&t.clientY<this.view.directionalButtonsY+(this.view.buttons._wy+5)+this.view.directionalButtonsH&&t.clientY>this.view.directionalButtonsY+this.view.directionalButtonsH?(this.view.buttons._hDown=0,this.view.buttons._xDown=this.view.directionalButtonsX,this.view.buttons._yDown=this.view.directionalButtonsY+this.view.directionalButtonsH):t.clientY<this.view.directionalButtonsY+this.view.directionalButtonsH&&t.clientY>this.view.directionalButtonsY-(this.view.buttons._wy-5)&&t.clientX<this.view.directionalButtonsX-(this.view.buttons._wx-5)-this.view.directionalButtonsH&&t.clientX>this.view.directionalButtonsX-2*this.view.buttons._wx&&(this.view.buttons._hLeft=0,this.view.buttons._xLeft=this.view.directionalButtonsX-this.view.directionalButtonsH,this.view.buttons._yLeft=this.view.directionalButtonsY))}mouseupFunction(t){this.model.activeJoystick&&(t.clientX>=this.model.backButtonX&&t.clientX<=this.model.backButtonWx+this.model.backButtonX&&t.clientY>=this.model.backButtonY&&t.clientY<=this.model.backButtonWy+this.model.backButtonY&&(this.model.backButtonColor="#232323",document.body.style.cursor="initial",this.backToMainMenu()),1==this.model.nbPlayers&&("run"==this.model.character1.move&&this.model.character1.stand(),this.model.countBeforeRunning1=0,this.view.joystick.x=this.view.joystick.centerX,this.view.joystick.y=this.view.joystick.centerY,this.model._isMoving=!1,this.model.pressed=!1,this.view.buttons._hUp=this.view.directionalButtonsH,this.view.buttons._xUp=this.view.directionalButtonsX,this.view.buttons._yUp=this.view.directionalButtonsY,this.view.buttons._hRight=this.view.directionalButtonsH,this.view.buttons._xRight=this.view.directionalButtonsX,this.view.buttons._yRight=this.view.directionalButtonsY,this.view.buttons._hDown=this.view.directionalButtonsH,this.view.buttons._xDown=this.view.directionalButtonsX,this.view.buttons._yDown=this.view.directionalButtonsY,this.view.buttons._hLeft=this.view.directionalButtonsH,this.view.buttons._xLeft=this.view.directionalButtonsX,this.view.buttons._yLeft=this.view.directionalButtonsY))}mousemoveFunction(t){this.model.activeJoystick&&(t.clientX>=this.model.backButtonX&&t.clientX<=this.model.backButtonWx+this.model.backButtonX&&t.clientY>=this.model.backButtonY&&t.clientY<=this.model.backButtonWy+this.model.backButtonY?(this.model.backButtonColor="#FFFFFF",document.body.style.cursor="pointer"):(this.model.backButtonColor="#232323",document.body.style.cursor="initial"),this.model._isMoving&&(t.clientX<=this.view.joystick.centerX+50&&t.clientX>=this.view.joystick.centerX-50&&(this.view.joystick.x=t.clientX),t.clientY<=this.view.joystick.centerY+50&&t.clientY>=this.view.joystick.centerY-50&&(this.view.joystick.y=t.clientY),"win"!=this.model.character1.move&&"lose"!=this.model.character1.move&&"fall"!=this.model.character1.move&&(t.clientY<=this.view.joystick.centerY-45?this.arrowUpMovement(this.model.character1):t.clientX>=this.view.joystick.centerX+30?(this.model.countBeforeRunning1=4,this.model._direction="E",this.model.character1.run(),this.arrowRightMovement(this.model.character1)):t.clientX>=this.view.joystick.centerX+10&&(this.model.countBeforeRunning1=0,this.arrowRightMovement(this.model.character1)))))}arrowRightMovement(t){"fall"!=t.move&&"jump"!=t.move&&"win"!=t.move&&"lose"!=t.move&&(this.model.countBeforeRunning1>3&&t==this.model.character1?(this.model._direction="E",t.run()):this.model.countBeforeRunning2>3&&t==this.model.character2?(this.model._direction2="E",t.run()):(this.model._direction=null,t.walk()))}arrowUpMovement(t){"win"!=this.model.character1.move&&"lose"!=this.model.character1.move&&"jump"!=this.model.character1.move&&(t.state=0,t.jump())}checkWinState(t,e,i,s){document.body.clientWidth>500?i.posX>60&&(t[13*e.width+380]=s,i.win(),2==this.model.nbPlayers&&(i==this.model.character2?this.model.character1.lose():this.model.character2.lose())):i.posX>15&&(t[13*e.width+380]=s,i.win())}checkJumpState(t){"jump"==t.move&&t.jump()}checkCamera(t,e){return document.body.clientWidth>500?t.posX>30&&e<320&&(e+=1,t.posX-=1):t.posX>1&&e<365&&(e+=1,t.posX-=1),e}checkFallState(t,e,i,s,o){return this.model.map.spritesSupport.includes(t[(i.posY+2)*this.view.canvas.width+Math.round(i.posX+s)+1])||(i.move="fall",i.fall()),i.posY>o&&(i.posX=0,s=0,i.posY=12,i.move="stand"),"fall"==i.move&&(i.posY>this.view.backgroundHeight||this.model.map.spritesSupport.includes(t[(i.posY+2)*this.view.canvas.width+Math.round(i.posX+s)+1]))&&(i.move="stand"),s}playMovements(){if(this.model._isMoving&&"fall"!=this.model.character1.model)switch(this.model._direction){case"N":this.arrowUpMovement(this.model.character1),this.model._isMoving=!1;break;case"E":this.arrowRightMovement(this.model.character1)}}manageWalkAndRun(){this.model.pressed?(this.model.countBeforeRunning1>10&&this.arrowRightMovement(this.model.character1),this.model.countBeforeRunning1++):this.model.countBeforeRunning1>3&&this.arrowRightMovement(this.model.character1),this.model.countBeforeRunning2>3&&this.arrowRightMovement(this.model.character2)}checking(t,e,i,s,o,n){return this.checkWinState(t,e,i,o),this.checkJumpState(i),s=this.checkCamera(i,s),s=this.checkFallState(t,e,i,s,n)}start(){this.loopPointer=window.requestAnimationFrame(t=>this.loop(t))}stop(){window.cancelAnimationFrame(this.loopPointer)}loop(t){this.loopPointer=window.requestAnimationFrame(t=>this.loop(t)),this.manageWalkAndRun(),this.view.draw(this.model),this.view.camera1=this.checking(this.model.map.tilemap,this.view.canvas,this.model.character1,this.view.camera1,this.model.map.savedBackground1,this.view.backgroundHeight),2==this.model.nbPlayers&&(this.view.camera2=this.checking(this.model.map.tilemap2,this.view.canvas2,this.model.character2,this.view.camera2,this.model.map.savedBackground2,this.view.backgroundHeight2)),this.playMovements()}}